2025-08-22T02:12:09.2019659Z ##[group]Run # Debug: Show test files
2025-08-22T02:12:09.2020001Z [36;1m# Debug: Show test files[0m
2025-08-22T02:12:09.2020299Z [36;1mecho "📋 Test files in directory:"[0m
2025-08-22T02:12:09.2020584Z [36;1mls -la tests/[0m
2025-08-22T02:12:09.2020797Z [36;1m[0m
2025-08-22T02:12:09.2021005Z [36;1m# Run tests with coverage collection[0m
2025-08-22T02:12:09.2021326Z [36;1mif npm run | grep -q "test:coverage"; then[0m
2025-08-22T02:12:09.2021657Z [36;1m  echo "🔍 Running npm run test:coverage"[0m
2025-08-22T02:12:09.2021950Z [36;1m  npm run test:coverage[0m
2025-08-22T02:12:09.2022220Z [36;1melif npm run | grep -q "test"; then[0m
2025-08-22T02:12:09.2022499Z [36;1m  echo "🔍 Running npm test"[0m
2025-08-22T02:12:09.2022753Z [36;1m  npm test[0m
2025-08-22T02:12:09.2022950Z [36;1melse[0m
2025-08-22T02:12:09.2023179Z [36;1m  echo "No test script found in package.json"[0m
2025-08-22T02:12:09.2023501Z [36;1m  exit 1[0m
2025-08-22T02:12:09.2023680Z [36;1mfi[0m
2025-08-22T02:12:09.2072081Z shell: /usr/bin/bash -e {0}
2025-08-22T02:12:09.2072518Z ##[endgroup]
2025-08-22T02:12:09.2144681Z 📋 Test files in directory:
2025-08-22T02:12:09.2159401Z total 148
2025-08-22T02:12:09.2160068Z drwxr-xr-x 2 runner docker  4096 Aug 22 02:11 .
2025-08-22T02:12:09.2160904Z drwxr-xr-x 8 runner docker  4096 Aug 22 02:12 ..
2025-08-22T02:12:09.2161759Z -rw-r--r-- 1 runner docker  1861 Aug 22 02:11 run-tests.js
2025-08-22T02:12:09.2162751Z -rw-r--r-- 1 runner docker  1594 Aug 22 02:11 setup-crypto-polyfill.js
2025-08-22T02:12:09.2163853Z -rw-r--r-- 1 runner docker 16856 Aug 22 02:11 test-comprehensive-coverage.js
2025-08-22T02:12:09.2164935Z -rw-r--r-- 1 runner docker 10118 Aug 22 02:11 test-coverage-gaps.js
2025-08-22T02:12:09.2165911Z -rw-r--r-- 1 runner docker  7214 Aug 22 02:11 test-fetch-handler.js
2025-08-22T02:12:09.2167173Z -rw-r--r-- 1 runner docker  9395 Aug 22 02:11 test-helper-functions.js
2025-08-22T02:12:09.2168201Z -rw-r--r-- 1 runner docker 18064 Aug 22 02:11 test-integration.js
2025-08-22T02:12:09.2169316Z -rw-r--r-- 1 runner docker 10160 Aug 22 02:11 test-kv-only-behavior.js
2025-08-22T02:12:09.2170298Z -rw-r--r-- 1 runner docker  7239 Aug 22 02:11 test-recipe-clipper.js
2025-08-22T02:12:09.2171392Z -rw-r--r-- 1 runner docker  9141 Aug 22 02:11 test-specific-recipe.js
2025-08-22T02:12:09.2172269Z -rw-r--r-- 1 runner docker 12535 Aug 22 02:11 test-unit-functions-fixed.js
2025-08-22T02:12:09.2173160Z -rw-r--r-- 1 runner docker  9879 Aug 22 02:11 test-utility-functions.js
2025-08-22T02:12:09.3563050Z 🔍 Running npm run test:coverage
2025-08-22T02:12:09.4807476Z 
2025-08-22T02:12:09.4808929Z > recipe-clipper-worker@1.0.0 test:coverage
2025-08-22T02:12:09.4810307Z > npx c8 --reporter=text --reporter=lcov node tests/run-tests.js
2025-08-22T02:12:09.4810813Z 
2025-08-22T02:12:10.0125764Z ✅ Crypto polyfill loaded for Node.js test environment
2025-08-22T02:12:10.0133097Z 🧪 Running Recipe Clipper Tests...
2025-08-22T02:12:10.0134242Z 
2025-08-22T02:12:10.0135017Z 📋 Found 9 test files:
2025-08-22T02:12:10.0137304Z    - test-comprehensive-coverage.js
2025-08-22T02:12:10.0137832Z    - test-coverage-gaps.js
2025-08-22T02:12:10.0138287Z    - test-fetch-handler.js
2025-08-22T02:12:10.0138729Z    - test-helper-functions.js
2025-08-22T02:12:10.0139178Z    - test-kv-only-behavior.js
2025-08-22T02:12:10.0139625Z    - test-recipe-clipper.js
2025-08-22T02:12:10.0140493Z    - test-specific-recipe.js
2025-08-22T02:12:10.0141155Z    - test-unit-functions-fixed.js
2025-08-22T02:12:10.0141967Z    - test-utility-functions.js
2025-08-22T02:12:10.0142442Z 
2025-08-22T02:12:10.0142467Z 
2025-08-22T02:12:10.0142956Z 🔍 Running test-comprehensive-coverage.js...
2025-08-22T02:12:10.0143733Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.0545224Z 🧪 Running Comprehensive Coverage Tests
2025-08-22T02:12:10.0546980Z 
2025-08-22T02:12:10.1375415Z ✅ OPTIONS request returns CORS headers
2025-08-22T02:12:10.1380389Z ✅ GET /health returns ok status
2025-08-22T02:12:10.1383364Z ✅ POST /clip with missing URL returns 400
2025-08-22T02:12:10.1401798Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1403063Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1404724Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1406284Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:200:20
2025-08-22T02:12:10.1408233Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1409830Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:195:1
2025-08-22T02:12:10.1411094Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1412297Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1413715Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1415247Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:229:20
2025-08-22T02:12:10.1417230Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1418795Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:209:1
2025-08-22T02:12:10.1420043Z ❌ POST /clip with valid URL extracts recipe
2025-08-22T02:12:10.1420867Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1421947Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1423341Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1424816Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:242:20
2025-08-22T02:12:10.1426383Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1428129Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:237:1
2025-08-22T02:12:10.1429320Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1430348Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1431690Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1433121Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:271:20
2025-08-22T02:12:10.1435008Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1436585Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:251:1
2025-08-22T02:12:10.1438032Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1439140Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1440517Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1442028Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:281:20
2025-08-22T02:12:10.1443623Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1445191Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:276:1
2025-08-22T02:12:10.1446463Z    Error: Assertion failed
2025-08-22T02:12:10.1447412Z ❌ POST /clip with cached recipe returns from cache
2025-08-22T02:12:10.1447970Z    Error: Assertion failed
2025-08-22T02:12:10.1448822Z ❌ POST /clip with JSON-LD recipe falls back to AI when incomplete
2025-08-22T02:12:10.1449438Z    Error: Assertion failed
2025-08-22T02:12:10.1450488Z ❌ POST /clip with no recipe returns error
2025-08-22T02:12:10.1451002Z    Error: Assertion failed
2025-08-22T02:12:10.1452344Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.1454145Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.1455759Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:475:18
2025-08-22T02:12:10.1457468Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:11)
2025-08-22T02:12:10.1458992Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:459:7
2025-08-22T02:12:10.1460806Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.1462599Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.1464150Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:492:18
2025-08-22T02:12:10.1465571Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:11)
2025-08-22T02:12:10.1467131Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:479:7
2025-08-22T02:12:10.1468173Z ✅ POST /clip handles fetch errors
2025-08-22T02:12:10.1468702Z ✅ Unknown route returns 404
2025-08-22T02:12:10.1469404Z ✅ extractRecipeFromAIResponse handles all field mappings
2025-08-22T02:12:10.1470192Z ✅ extractRecipeFromAIResponse handles array fields
2025-08-22T02:12:10.1470952Z ✅ extractRecipeFromAIResponse handles object fields
2025-08-22T02:12:10.1471759Z ✅ extractRecipeFromAIResponse validates required fields
2025-08-22T02:12:10.1472592Z ✅ extractRecipeFromAIResponse handles malformed response
2025-08-22T02:12:10.1473469Z ✅ extractRecipeFromAIResponse handles empty response
2025-08-22T02:12:10.1474166Z Recipe Clipper Error: Error: Invalid JSON
2025-08-22T02:12:10.1475312Z     at Object.json (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:526:31)
2025-08-22T02:12:10.1476985Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:27:36)
2025-08-22T02:12:10.1478675Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:529:33
2025-08-22T02:12:10.1480084Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:11)
2025-08-22T02:12:10.1481475Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:520:7
2025-08-22T02:12:10.1482617Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1483726Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1485001Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1486364Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:544:20
2025-08-22T02:12:10.1487991Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1489419Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:533:1
2025-08-22T02:12:10.1490868Z ✅ extractRecipeFromAIResponse handles null response
2025-08-22T02:12:10.1491582Z ✅ Handle JSON parse errors in request body
2025-08-22T02:12:10.1492173Z ❌ Handle KV storage errors gracefully
2025-08-22T02:12:10.1492588Z    Error: Assertion failed
2025-08-22T02:12:10.1493243Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.1494263Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.1495537Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.1497101Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:558:20
2025-08-22T02:12:10.1498557Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:12:5)
2025-08-22T02:12:10.1500062Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-comprehensive-coverage.js:553:1
2025-08-22T02:12:10.1501051Z ✅ Handle bad HTTP response
2025-08-22T02:12:10.1501300Z 
2025-08-22T02:12:10.1501542Z ==================================================
2025-08-22T02:12:10.1502173Z 📊 Comprehensive Coverage Test Summary:
2025-08-22T02:12:10.1502653Z    ✅ Passed: 14
2025-08-22T02:12:10.1502993Z    ❌ Failed: 5
2025-08-22T02:12:10.1503339Z    📁 Total: 19
2025-08-22T02:12:10.1503519Z 
2025-08-22T02:12:10.1503828Z ⚠️  Some comprehensive tests failed.
2025-08-22T02:12:10.1680426Z ❌ test-comprehensive-coverage.js failed
2025-08-22T02:12:10.1680832Z 
2025-08-22T02:12:10.1681233Z 🔍 Running test-coverage-gaps.js...
2025-08-22T02:12:10.1682102Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.2075048Z ✅ Crypto polyfill loaded for Node.js test environment
2025-08-22T02:12:10.2080654Z 🧪 Running Coverage Gap Tests
2025-08-22T02:12:10.2080998Z 
2025-08-22T02:12:10.2383723Z ✅ GET /health returns ok
2025-08-22T02:12:10.2387693Z ✅ OPTIONS request returns CORS headers
2025-08-22T02:12:10.2396669Z Recipe not found in KV store, proceeding with clipping
2025-08-22T02:12:10.2400727Z Fetching content from: https://example.com/test
2025-08-22T02:12:10.2406180Z HTML fetched, length: 411
2025-08-22T02:12:10.2406919Z Checking for JSON-LD recipe data...
2025-08-22T02:12:10.2412599Z Found 1 JSON-LD script(s)
2025-08-22T02:12:10.2414079Z Parsing JSON-LD content (first 200 chars): {
2025-08-22T02:12:10.2414732Z             "@context": "https://schema.org",
2025-08-22T02:12:10.2415309Z             "@type": "Recipe",
2025-08-22T02:12:10.2415817Z             "name": "Test",
2025-08-22T02:12:10.2416355Z             "image": "https://example.com/test.jpg",
2025-08-22T02:12:10.2417202Z             "recipeIngredient": ["flour"...
2025-08-22T02:12:10.2429360Z JSON-LD parsed successfully, structure: { hasType: true, type: 'Recipe', hasGraph: false, graphLength: 0 }
2025-08-22T02:12:10.2430731Z Found direct Recipe object
2025-08-22T02:12:10.2432392Z Found Recipe in JSON-LD! Recipe structure: {
2025-08-22T02:12:10.2433081Z   name: 'Test',
2025-08-22T02:12:10.2433477Z   hasIngredients: true,
2025-08-22T02:12:10.2433868Z   ingredientCount: 1,
2025-08-22T02:12:10.2434257Z   hasInstructions: true,
2025-08-22T02:12:10.2434653Z   instructionCount: 1
2025-08-22T02:12:10.2434995Z }
2025-08-22T02:12:10.2437850Z Normalizing JSON-LD recipe: {
2025-08-22T02:12:10.2438310Z   name: 'Test',
2025-08-22T02:12:10.2438660Z   hasImage: true,
2025-08-22T02:12:10.2439041Z   hasDescription: false,
2025-08-22T02:12:10.2439435Z   hasAuthor: false,
2025-08-22T02:12:10.2439818Z   hasIngredients: true,
2025-08-22T02:12:10.2440198Z   ingredientCount: 1,
2025-08-22T02:12:10.2440601Z   hasInstructions: true,
2025-08-22T02:12:10.2441018Z   instructionCount: 1
2025-08-22T02:12:10.2441369Z }
2025-08-22T02:12:10.2442640Z Normalized recipe: {
2025-08-22T02:12:10.2443047Z   name: 'Test',
2025-08-22T02:12:10.2443498Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2444279Z   ingredientCount: 1,
2025-08-22T02:12:10.2444669Z   instructionCount: 1
2025-08-22T02:12:10.2445026Z }
2025-08-22T02:12:10.2445440Z JSON-LD recipe validation passed!
2025-08-22T02:12:10.2446026Z Found recipe in JSON-LD! Skipping LLM call.
2025-08-22T02:12:10.2446627Z Recipe extracted from JSON-LD: {
2025-08-22T02:12:10.2447262Z   name: 'Test',
2025-08-22T02:12:10.2447607Z   ingredients: 1,
2025-08-22T02:12:10.2447955Z   instructions: 1,
2025-08-22T02:12:10.2448388Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2448871Z   description: '...'
2025-08-22T02:12:10.2449193Z }
2025-08-22T02:12:10.2449597Z Recipe saved to KV store successfully
2025-08-22T02:12:10.2451834Z ✅ JSON-LD with array keywords
2025-08-22T02:12:10.2455944Z Recipe not found in KV store, proceeding with clipping
2025-08-22T02:12:10.2456927Z Fetching content from: https://example.com/test
2025-08-22T02:12:10.2457518Z HTML fetched, length: 349
2025-08-22T02:12:10.2457990Z Checking for JSON-LD recipe data...
2025-08-22T02:12:10.2458481Z Found 1 JSON-LD script(s)
2025-08-22T02:12:10.2460080Z Parsing JSON-LD content (first 200 chars): {
2025-08-22T02:12:10.2460697Z         "@context": "https://schema.org",
2025-08-22T02:12:10.2461193Z         "@type": "Recipe",
2025-08-22T02:12:10.2461651Z         "name": "String Ingredients",
2025-08-22T02:12:10.2462193Z         "image": "https://example.com/test.jpg",
2025-08-22T02:12:10.2462775Z         "recipeIngredient": "flour, eggs, ...
2025-08-22T02:12:10.2464044Z JSON-LD parsed successfully, structure: { hasType: true, type: 'Recipe', hasGraph: false, graphLength: 0 }
2025-08-22T02:12:10.2465068Z Found direct Recipe object
2025-08-22T02:12:10.2465638Z Found Recipe in JSON-LD! Recipe structure: {
2025-08-22T02:12:10.2466165Z   name: 'String Ingredients',
2025-08-22T02:12:10.2466587Z   hasIngredients: true,
2025-08-22T02:12:10.2467167Z   ingredientCount: 18,
2025-08-22T02:12:10.2467555Z   hasInstructions: true,
2025-08-22T02:12:10.2467944Z   instructionCount: 1
2025-08-22T02:12:10.2468308Z }
2025-08-22T02:12:10.2468653Z Normalizing JSON-LD recipe: {
2025-08-22T02:12:10.2469099Z   name: 'String Ingredients',
2025-08-22T02:12:10.2469494Z   hasImage: true,
2025-08-22T02:12:10.2469837Z   hasDescription: false,
2025-08-22T02:12:10.2470226Z   hasAuthor: false,
2025-08-22T02:12:10.2470597Z   hasIngredients: true,
2025-08-22T02:12:10.2470983Z   ingredientCount: 18,
2025-08-22T02:12:10.2471370Z   hasInstructions: true,
2025-08-22T02:12:10.2471762Z   instructionCount: 1
2025-08-22T02:12:10.2472113Z }
2025-08-22T02:12:10.2472437Z Normalized recipe: {
2025-08-22T02:12:10.2472817Z   name: 'String Ingredients',
2025-08-22T02:12:10.2473328Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2473816Z   ingredientCount: 1,
2025-08-22T02:12:10.2474203Z   instructionCount: 1
2025-08-22T02:12:10.2474550Z }
2025-08-22T02:12:10.2474939Z JSON-LD recipe validation passed!
2025-08-22T02:12:10.2475822Z Found recipe in JSON-LD! Skipping LLM call.
2025-08-22T02:12:10.2476410Z Recipe extracted from JSON-LD: {
2025-08-22T02:12:10.2477069Z   name: 'String Ingredients',
2025-08-22T02:12:10.2477482Z   ingredients: 1,
2025-08-22T02:12:10.2477813Z   instructions: 1,
2025-08-22T02:12:10.2478256Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2478730Z   description: '...'
2025-08-22T02:12:10.2479054Z }
2025-08-22T02:12:10.2479440Z Recipe saved to KV store successfully
2025-08-22T02:12:10.2480105Z ✅ JSON-LD with string ingredients
2025-08-22T02:12:10.2480725Z Recipe not found in KV store, proceeding with clipping
2025-08-22T02:12:10.2481395Z Fetching content from: https://example.com/test
2025-08-22T02:12:10.2481899Z HTML fetched, length: 505
2025-08-22T02:12:10.2482348Z Checking for JSON-LD recipe data...
2025-08-22T02:12:10.2482824Z Found 1 JSON-LD script(s)
2025-08-22T02:12:10.2483311Z Parsing JSON-LD content (first 200 chars): {
2025-08-22T02:12:10.2483853Z         "@context": "https://schema.org",
2025-08-22T02:12:10.2484294Z         "@type": "Recipe",
2025-08-22T02:12:10.2484933Z         "name": "Object Instructions",
2025-08-22T02:12:10.2485438Z         "image": "https://example.com/test.jpg",
2025-08-22T02:12:10.2485956Z         "recipeIngredient": ["flour"],
2025-08-22T02:12:10.2486347Z   ...
2025-08-22T02:12:10.2487518Z JSON-LD parsed successfully, structure: { hasType: true, type: 'Recipe', hasGraph: false, graphLength: 0 }
2025-08-22T02:12:10.2488393Z Found direct Recipe object
2025-08-22T02:12:10.2488940Z Found Recipe in JSON-LD! Recipe structure: {
2025-08-22T02:12:10.2489499Z   name: 'Object Instructions',
2025-08-22T02:12:10.2489943Z   hasIngredients: true,
2025-08-22T02:12:10.2490324Z   ingredientCount: 1,
2025-08-22T02:12:10.2490716Z   hasInstructions: true,
2025-08-22T02:12:10.2491107Z   instructionCount: 3
2025-08-22T02:12:10.2491458Z }
2025-08-22T02:12:10.2491831Z Normalizing JSON-LD recipe: {
2025-08-22T02:12:10.2492306Z   name: 'Object Instructions',
2025-08-22T02:12:10.2492729Z   hasImage: true,
2025-08-22T02:12:10.2493090Z   hasDescription: false,
2025-08-22T02:12:10.2493477Z   hasAuthor: false,
2025-08-22T02:12:10.2493824Z   hasIngredients: true,
2025-08-22T02:12:10.2494203Z   ingredientCount: 1,
2025-08-22T02:12:10.2494586Z   hasInstructions: true,
2025-08-22T02:12:10.2494984Z   instructionCount: 3
2025-08-22T02:12:10.2495335Z }
2025-08-22T02:12:10.2495716Z Normalized recipe: {
2025-08-22T02:12:10.2496135Z   name: 'Object Instructions',
2025-08-22T02:12:10.2496656Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2497351Z   ingredientCount: 1,
2025-08-22T02:12:10.2497717Z   instructionCount: 3
2025-08-22T02:12:10.2498060Z }
2025-08-22T02:12:10.2498439Z JSON-LD recipe validation passed!
2025-08-22T02:12:10.2499018Z Found recipe in JSON-LD! Skipping LLM call.
2025-08-22T02:12:10.2499616Z Recipe extracted from JSON-LD: {
2025-08-22T02:12:10.2500121Z   name: 'Object Instructions',
2025-08-22T02:12:10.2500543Z   ingredients: 1,
2025-08-22T02:12:10.2500910Z   instructions: 3,
2025-08-22T02:12:10.2501358Z   image: 'https://example.com/test.jpg',
2025-08-22T02:12:10.2501854Z   description: '...'
2025-08-22T02:12:10.2502191Z }
2025-08-22T02:12:10.2502599Z Recipe saved to KV store successfully
2025-08-22T02:12:10.2503267Z ✅ JSON-LD with object instructions
2025-08-22T02:12:10.2503846Z ✅ Invalid method returns 404
2025-08-22T02:12:10.2505233Z ✅ Missing URL returns error
2025-08-22T02:12:10.2510834Z Recipe found in KV store, returning cached version
2025-08-22T02:12:10.2514005Z ✅ Cached recipe is returned from KV store
2025-08-22T02:12:10.2514420Z 
2025-08-22T02:12:10.2514715Z 📊 Coverage Gap Test Summary:
2025-08-22T02:12:10.2515218Z    ✅ Passed: 8
2025-08-22T02:12:10.2515600Z    ❌ Failed: 0
2025-08-22T02:12:10.2515963Z    📁 Total: 8
2025-08-22T02:12:10.2516148Z 
2025-08-22T02:12:10.2516468Z 🎉 All coverage gap tests passed!
2025-08-22T02:12:10.2784171Z ✅ test-coverage-gaps.js completed successfully
2025-08-22T02:12:10.2784639Z 
2025-08-22T02:12:10.2785339Z 🔍 Running test-fetch-handler.js...
2025-08-22T02:12:10.2786139Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.3238824Z 🧪 Running Fetch Handler Tests
2025-08-22T02:12:10.3239191Z 
2025-08-22T02:12:10.3503939Z ✅ handles OPTIONS request
2025-08-22T02:12:10.3517002Z ✅ handles health check
2025-08-22T02:12:10.3520057Z ✅ returns 404 for unknown routes
2025-08-22T02:12:10.3521341Z ✅ returns 400 for missing URL
2025-08-22T02:12:10.3524017Z ✅ returns cached recipe when available
2025-08-22T02:12:10.3526605Z ✅ handles GET /recipes/:id
2025-08-22T02:12:10.3529707Z ✅ returns 404 for non-existent recipe
2025-08-22T02:12:10.3531768Z ✅ handles DELETE /recipes/:id
2025-08-22T02:12:10.3534048Z ✅ handles PUT /recipes/:id
2025-08-22T02:12:10.3536056Z ✅ handles fetch errors gracefully
2025-08-22T02:12:10.3537414Z    (Skipping actual HTML extraction test - would need full env)
2025-08-22T02:12:10.3538526Z ✅ extracts recipe from HTML response
2025-08-22T02:12:10.3539125Z 
2025-08-22T02:12:10.3539907Z ==================================================
2025-08-22T02:12:10.3541225Z 📊 Fetch Handler Test Summary:
2025-08-22T02:12:10.3542348Z    ✅ Passed: 11
2025-08-22T02:12:10.3543492Z    ❌ Failed: 0
2025-08-22T02:12:10.3544119Z    📁 Total: 11
2025-08-22T02:12:10.3544464Z 
2025-08-22T02:12:10.3544877Z 🎉 All fetch handler tests passed!
2025-08-22T02:12:10.3742217Z ✅ test-fetch-handler.js completed successfully
2025-08-22T02:12:10.3742665Z 
2025-08-22T02:12:10.3743042Z 🔍 Running test-helper-functions.js...
2025-08-22T02:12:10.3743818Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.4103242Z 🧪 Running Helper Function Tests
2025-08-22T02:12:10.4103568Z 
2025-08-22T02:12:10.4113468Z ✅ extractDescriptionFromHTML - handles various meta formats
2025-08-22T02:12:10.4118130Z ✅ extractYieldFromHTML - handles various yield formats
2025-08-22T02:12:10.4121512Z ✅ convertTimeToISO8601 - handles various time formats
2025-08-22T02:12:10.4129380Z ✅ cleanHtmlForGPT - removes unwanted elements
2025-08-22T02:12:10.4132521Z ✅ cleanHtmlForGPT - truncates long content
2025-08-22T02:12:10.4138818Z ✅ extractRecipeContent - extracts recipe sections
2025-08-22T02:12:10.4140182Z ✅ extractRecipeContent - limits to 10 sections
2025-08-22T02:12:10.4140891Z ✅ handles empty or null inputs gracefully
2025-08-22T02:12:10.4141732Z ✅ handles HTML entities in extracted content
2025-08-22T02:12:10.4142421Z ✅ handles malformed HTML gracefully
2025-08-22T02:12:10.4143115Z ✅ handles special characters in time conversion
2025-08-22T02:12:10.4143778Z ✅ handles nested HTML structures
2025-08-22T02:12:10.4144528Z ✅ handles case sensitivity in patterns
2025-08-22T02:12:10.4144828Z 
2025-08-22T02:12:10.4145068Z ==================================================
2025-08-22T02:12:10.4145631Z 📊 Helper Function Test Summary:
2025-08-22T02:12:10.4146078Z    ✅ Passed: 13
2025-08-22T02:12:10.4146401Z    ❌ Failed: 0
2025-08-22T02:12:10.4146855Z    📁 Total: 13
2025-08-22T02:12:10.4147119Z 
2025-08-22T02:12:10.4147421Z 🎉 All helper function tests passed!
2025-08-22T02:12:10.4241833Z ✅ test-helper-functions.js completed successfully
2025-08-22T02:12:10.4242261Z 
2025-08-22T02:12:10.4242764Z 🔍 Running test-kv-only-behavior.js...
2025-08-22T02:12:10.4243441Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.4650262Z 🧪 Testing KV Store-Only Behavior for Clipped Recipes
2025-08-22T02:12:10.4651016Z 
2025-08-22T02:12:10.4660164Z ✅ Recipe clipping saves only to KV store
2025-08-22T02:12:10.4662064Z ✅ Cached recipes retrieved only from KV store
2025-08-22T02:12:10.4934559Z ✅ Recipe deletion only affects KV store
2025-08-22T02:12:10.4937219Z ✅ Clipper worker has no database endpoints
2025-08-22T02:12:10.4940089Z ✅ Clipper worker only has KV-related endpoints
2025-08-22T02:12:10.4944068Z ✅ KV storage functions work correctly
2025-08-22T02:12:10.4945955Z ✅ No HTTP calls to external databases during recipe clipping
2025-08-22T02:12:10.4946423Z 
2025-08-22T02:12:10.4946864Z ==================================================
2025-08-22T02:12:10.4947960Z 📊 KV Store-Only Test Summary:
2025-08-22T02:12:10.4948435Z    ✅ Passed: 7
2025-08-22T02:12:10.4948831Z    ❌ Failed: 0
2025-08-22T02:12:10.4949195Z    📁 Total: 7
2025-08-22T02:12:10.4949380Z 
2025-08-22T02:12:10.4949694Z 🎉 All KV store-only tests passed!
2025-08-22T02:12:10.4950408Z ✅ Verified: Clipped recipes only save to KV store
2025-08-22T02:12:10.5140013Z ✅ test-kv-only-behavior.js completed successfully
2025-08-22T02:12:10.5140506Z 
2025-08-22T02:12:10.5140881Z 🔍 Running test-recipe-clipper.js...
2025-08-22T02:12:10.5141693Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.5533663Z 🧪 Running Recipe Clipper Tests
2025-08-22T02:12:10.5534034Z 
2025-08-22T02:12:10.5540052Z Test 1: Null response from AI (truncated HTML)
2025-08-22T02:12:10.5541144Z Description: AI correctly returns null when HTML is truncated and recipe data is incomplete
2025-08-22T02:12:10.5547188Z ✅ PASSED
2025-08-22T02:12:10.5547910Z ---
2025-08-22T02:12:10.5548208Z 
2025-08-22T02:12:10.5548706Z Test 2: Valid recipe response
2025-08-22T02:12:10.5549498Z Description: AI returns complete recipe data that should be parsed correctly
2025-08-22T02:12:10.5551783Z ✅ PASSED
2025-08-22T02:12:10.5552071Z ---
2025-08-22T02:12:10.5552703Z 
2025-08-22T02:12:10.5552997Z Test 3: Recipe with alternative field names
2025-08-22T02:12:10.5553987Z Description: AI returns recipe with alternative field names that should be mapped correctly
2025-08-22T02:12:10.5555009Z ✅ PASSED
2025-08-22T02:12:10.5555334Z ---
2025-08-22T02:12:10.5555518Z 
2025-08-22T02:12:10.5555875Z Test 4: Recipe with string ingredients/instructions
2025-08-22T02:12:10.5557165Z Description: AI returns ingredients/instructions as strings that should be split into arrays
2025-08-22T02:12:10.5558398Z ✅ PASSED
2025-08-22T02:12:10.5558710Z ---
2025-08-22T02:12:10.5558884Z 
2025-08-22T02:12:10.5559095Z Test 5: Empty response object
2025-08-22T02:12:10.5559677Z Description: Empty response should return null
2025-08-22T02:12:10.5579356Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.5581496Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.5582582Z ✅ PASSED
2025-08-22T02:12:10.5583042Z ---
2025-08-22T02:12:10.5583256Z 
2025-08-22T02:12:10.5583524Z Test 6: Response with missing content
2025-08-22T02:12:10.5584291Z Description: Response with missing content should return null
2025-08-22T02:12:10.5584986Z ✅ PASSED
2025-08-22T02:12:10.5585298Z ---
2025-08-22T02:12:10.5585464Z 
2025-08-22T02:12:10.5585711Z Test 7: Response with invalid JSON
2025-08-22T02:12:10.5586300Z Description: Invalid JSON should return null
2025-08-22T02:12:10.5587476Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:224:22
2025-08-22T02:12:10.5588397Z     at Array.forEach (<anonymous>)
2025-08-22T02:12:10.5589412Z     at runTests (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:219:13)
2025-08-22T02:12:10.5590818Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:259:3
2025-08-22T02:12:10.5591872Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.5592739Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.5593580Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.5594388Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.5595936Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.5597966Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.5599382Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:224:22
2025-08-22T02:12:10.5600454Z     at Array.forEach (<anonymous>)
2025-08-22T02:12:10.5601397Z     at runTests (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:219:13)
2025-08-22T02:12:10.5602543Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:259:3
2025-08-22T02:12:10.5603200Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.5604021Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.5604830Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.5605605Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.5606492Z Cleaned JSON content (first 300 chars): { invalid json content...
2025-08-22T02:12:10.5607742Z Error extracting recipe from AI response: Error: Failed to parse recipe data from AI response
2025-08-22T02:12:10.5609161Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1830:13)
2025-08-22T02:12:10.5610843Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:224:22
2025-08-22T02:12:10.5611689Z     at Array.forEach (<anonymous>)
2025-08-22T02:12:10.5612632Z     at runTests (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:219:13)
2025-08-22T02:12:10.5613918Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-recipe-clipper.js:259:3
2025-08-22T02:12:10.5614883Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.5615688Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.5616456Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.5617428Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.5618098Z ✅ PASSED
2025-08-22T02:12:10.5618379Z ---
2025-08-22T02:12:10.5618533Z 
2025-08-22T02:12:10.5618552Z 
2025-08-22T02:12:10.5618870Z 📊 Test Results: 7 passed, 0 failed
2025-08-22T02:12:10.5619354Z 🎉 All tests passed!
2025-08-22T02:12:10.5722961Z ✅ test-recipe-clipper.js completed successfully
2025-08-22T02:12:10.5723355Z 
2025-08-22T02:12:10.5723732Z 🔍 Running test-specific-recipe.js...
2025-08-22T02:12:10.5724537Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.6119169Z 🚀 Starting Chef John's Recipe Tests
2025-08-22T02:12:10.6119549Z 
2025-08-22T02:12:10.6125702Z 🧪 Testing Chef John's Salt Roasted Chicken Recipe Extraction
2025-08-22T02:12:10.6127268Z 📍 URL: https://www.allrecipes.com/recipe/235171/chef-johns-salt-roasted-chicken/
2025-08-22T02:12:10.6127926Z 
2025-08-22T02:12:10.6136181Z ✅ Recipe extraction successful!
2025-08-22T02:12:10.6136528Z 
2025-08-22T02:12:10.6136959Z 📋 Recipe Details:
2025-08-22T02:12:10.6137423Z    Name: Chef John's Salt Roasted Chicken
2025-08-22T02:12:10.6138954Z    Description: This is one of those rare recipes where the name is the same as the ingredient list. You're going to be so shocked at how flavorful, juicy, and amazing this roast chicken comes out.
2025-08-22T02:12:10.6140273Z    Author: John Mitzewich
2025-08-22T02:12:10.6140755Z    Rating: undefined (undefined reviews)
2025-08-22T02:12:10.6141246Z    Prep Time: undefined
2025-08-22T02:12:10.6141640Z    Cook Time: undefined
2025-08-22T02:12:10.6142010Z    Total Time: undefined
2025-08-22T02:12:10.6142391Z    Servings: undefined
2025-08-22T02:12:10.6142772Z    Difficulty: undefined
2025-08-22T02:12:10.6143457Z    Image: https://images.media-allrecipes.com/userphotos/720x405/4560646.jpg
2025-08-22T02:12:10.6144522Z    Source: https://www.allrecipes.com/recipe/235171/chef-johns-salt-roasted-chicken/
2025-08-22T02:12:10.6145122Z 
2025-08-22T02:12:10.6145586Z 🥘 Ingredients (${recipe.ingredients.length}):
2025-08-22T02:12:10.6146231Z    1. 1 (3 1/2) pound whole chicken at room temperature
2025-08-22T02:12:10.6147393Z    2. 3 tablespoons kosher salt, or as needed
2025-08-22T02:12:10.6147975Z    3. 1 tablespoon chopped fresh thyme
2025-08-22T02:12:10.6148513Z    4. 1 lemon, juiced
2025-08-22T02:12:10.6149023Z    5. ⅓ cup chicken broth
2025-08-22T02:12:10.6149534Z    6. 1 tablespoon water, or as needed (Optional)
2025-08-22T02:12:10.6150234Z    7. 2 tablespoons cold butter, cut into four pieces
2025-08-22T02:12:10.6150898Z    8. salt and freshly ground black pepper to taste
2025-08-22T02:12:10.6151505Z    9. 1 pinch cayenne pepper, or to taste
2025-08-22T02:12:10.6151833Z 
2025-08-22T02:12:10.6152317Z 👨‍🍳 Instructions (${recipe.instructions.length}):
2025-08-22T02:12:10.6153001Z    1. Preheat oven to 450 degrees F (230 degrees C).
2025-08-22T02:12:10.6154493Z    2. Dry the outside of chicken with paper towels. Tuck the wing tips underneath the chicken and place into a large oven-safe skillet. Use scissors to snip off the tail, if desired.
2025-08-22T02:12:10.6157419Z    3. Generously sprinkle kosher salt into the cavity and over the back and sides of chicken. Tie chicken legs together with kitchen twine. Sprinkle salt generously over the breasts, coating them thoroughly. Wipe excess salt out of skillet with paper towels.
2025-08-22T02:12:10.6160861Z    4. Bake chicken in the preheated oven until an instant-read meat thermometer inserted into a thigh, not touching bone, reads 160 degrees C (70 degrees C), 50 to 60 minutes. Remove from skillet to a serving platter and let rest 5 to 10 minutes.
2025-08-22T02:12:10.6164837Z    5. Blot about 90 percent of the chicken fat from the skillet with a paper towel held with tongs, leaving the browned bits of food in the skillet. Place skillet over medium-high heat and add thyme leaves. Cook and stir until thyme is wilted, 1 to 2 minutes. Pour lemon juice, chicken broth, and water into skillet, stirring until the browned bits dissolve and the sauce has reduced by about half, 1 to 2 minutes.
2025-08-22T02:12:10.6169460Z    6. Reduce heat to low, add cold butter, and stir until butter has begun to melt. Add any accumulated juices from the chicken to sauce and continue to stir until butter is incorporated and sauce is slightly thickened, about 1 minute. Remove from heat and season with salt, black pepper, and cayenne pepper to taste. Spoon sauce over chicken to serve.
2025-08-22T02:12:10.6171436Z 
2025-08-22T02:12:10.6171701Z 📊 Full Recipe Data:
2025-08-22T02:12:10.6172043Z {
2025-08-22T02:12:10.6172407Z   "name": "Chef John's Salt Roasted Chicken",
2025-08-22T02:12:10.6173222Z   "image": "https://images.media-allrecipes.com/userphotos/720x405/4560646.jpg",
2025-08-22T02:12:10.6174858Z   "description": "This is one of those rare recipes where the name is the same as the ingredient list. You're going to be so shocked at how flavorful, juicy, and amazing this roast chicken comes out.",
2025-08-22T02:12:10.6176121Z   "author": "John Mitzewich",
2025-08-22T02:12:10.6176521Z   "datePublished": "",
2025-08-22T02:12:10.6177060Z   "prepTime": "",
2025-08-22T02:12:10.6177382Z   "cookTime": "",
2025-08-22T02:12:10.6177707Z   "totalTime": "",
2025-08-22T02:12:10.6178027Z   "recipeYield": "4",
2025-08-22T02:12:10.6178381Z   "recipeCategory": "",
2025-08-22T02:12:10.6178727Z   "recipeCuisine": "",
2025-08-22T02:12:10.6179056Z   "keywords": "",
2025-08-22T02:12:10.6179374Z   "recipeIngredient": [
2025-08-22T02:12:10.6179847Z     "1 (3 1/2) pound whole chicken at room temperature",
2025-08-22T02:12:10.6180417Z     "3 tablespoons kosher salt, or as needed",
2025-08-22T02:12:10.6180943Z     "1 tablespoon chopped fresh thyme",
2025-08-22T02:12:10.6181368Z     "1 lemon, juiced",
2025-08-22T02:12:10.6181809Z     "⅓ cup chicken broth",
2025-08-22T02:12:10.6182274Z     "1 tablespoon water, or as needed (Optional)",
2025-08-22T02:12:10.6182865Z     "2 tablespoons cold butter, cut into four pieces",
2025-08-22T02:12:10.6183465Z     "salt and freshly ground black pepper to taste",
2025-08-22T02:12:10.6184010Z     "1 pinch cayenne pepper, or to taste"
2025-08-22T02:12:10.6184416Z   ],
2025-08-22T02:12:10.6184978Z   "recipeInstructions": [
2025-08-22T02:12:10.6185333Z     {
2025-08-22T02:12:10.6185619Z       "@type": "HowToStep",
2025-08-22T02:12:10.6186162Z       "text": "Preheat oven to 450 degrees F (230 degrees C)."
2025-08-22T02:12:10.6186658Z     },
2025-08-22T02:12:10.6187076Z     {
2025-08-22T02:12:10.6187364Z       "@type": "HowToStep",
2025-08-22T02:12:10.6188710Z       "text": "Dry the outside of chicken with paper towels. Tuck the wing tips underneath the chicken and place into a large oven-safe skillet. Use scissors to snip off the tail, if desired."
2025-08-22T02:12:10.6189908Z     },
2025-08-22T02:12:10.6190179Z     {
2025-08-22T02:12:10.6190452Z       "@type": "HowToStep",
2025-08-22T02:12:10.6192326Z       "text": "Generously sprinkle kosher salt into the cavity and over the back and sides of chicken. Tie chicken legs together with kitchen twine. Sprinkle salt generously over the breasts, coating them thoroughly. Wipe excess salt out of skillet with paper towels."
2025-08-22T02:12:10.6193982Z     },
2025-08-22T02:12:10.6194244Z     {
2025-08-22T02:12:10.6194530Z       "@type": "HowToStep",
2025-08-22T02:12:10.6196435Z       "text": "Bake chicken in the preheated oven until an instant-read meat thermometer inserted into a thigh, not touching bone, reads 160 degrees C (70 degrees C), 50 to 60 minutes. Remove from skillet to a serving platter and let rest 5 to 10 minutes."
2025-08-22T02:12:10.6198104Z     },
2025-08-22T02:12:10.6198369Z     {
2025-08-22T02:12:10.6198651Z       "@type": "HowToStep",
2025-08-22T02:12:10.6201393Z       "text": "Blot about 90 percent of the chicken fat from the skillet with a paper towel held with tongs, leaving the browned bits of food in the skillet. Place skillet over medium-high heat and add thyme leaves. Cook and stir until thyme is wilted, 1 to 2 minutes. Pour lemon juice, chicken broth, and water into skillet, stirring until the browned bits dissolve and the sauce has reduced by about half, 1 to 2 minutes."
2025-08-22T02:12:10.6203720Z     },
2025-08-22T02:12:10.6203977Z     {
2025-08-22T02:12:10.6204237Z       "@type": "HowToStep",
2025-08-22T02:12:10.6206607Z       "text": "Reduce heat to low, add cold butter, and stir until butter has begun to melt. Add any accumulated juices from the chicken to sauce and continue to stir until butter is incorporated and sauce is slightly thickened, about 1 minute. Remove from heat and season with salt, black pepper, and cayenne pepper to taste. Spoon sauce over chicken to serve."
2025-08-22T02:12:10.6208812Z     }
2025-08-22T02:12:10.6209062Z   ],
2025-08-22T02:12:10.6209321Z   "nutrition": null,
2025-08-22T02:12:10.6209660Z   "aggregateRating": null,
2025-08-22T02:12:10.6209997Z   "video": null,
2025-08-22T02:12:10.6210699Z   "source_url": "https://www.allrecipes.com/recipe/235171/chef-johns-salt-roasted-chicken/",
2025-08-22T02:12:10.6211409Z   "ingredients": [
2025-08-22T02:12:10.6211838Z     "1 (3 1/2) pound whole chicken at room temperature",
2025-08-22T02:12:10.6212389Z     "3 tablespoons kosher salt, or as needed",
2025-08-22T02:12:10.6212897Z     "1 tablespoon chopped fresh thyme",
2025-08-22T02:12:10.6213303Z     "1 lemon, juiced",
2025-08-22T02:12:10.6213732Z     "⅓ cup chicken broth",
2025-08-22T02:12:10.6214172Z     "1 tablespoon water, or as needed (Optional)",
2025-08-22T02:12:10.6214743Z     "2 tablespoons cold butter, cut into four pieces",
2025-08-22T02:12:10.6215331Z     "salt and freshly ground black pepper to taste",
2025-08-22T02:12:10.6215864Z     "1 pinch cayenne pepper, or to taste"
2025-08-22T02:12:10.6216268Z   ],
2025-08-22T02:12:10.6216536Z   "instructions": [
2025-08-22T02:12:10.6217113Z     "Preheat oven to 450 degrees F (230 degrees C).",
2025-08-22T02:12:10.6218517Z     "Dry the outside of chicken with paper towels. Tuck the wing tips underneath the chicken and place into a large oven-safe skillet. Use scissors to snip off the tail, if desired.",
2025-08-22T02:12:10.6221145Z     "Generously sprinkle kosher salt into the cavity and over the back and sides of chicken. Tie chicken legs together with kitchen twine. Sprinkle salt generously over the breasts, coating them thoroughly. Wipe excess salt out of skillet with paper towels.",
2025-08-22T02:12:10.6224350Z     "Bake chicken in the preheated oven until an instant-read meat thermometer inserted into a thigh, not touching bone, reads 160 degrees C (70 degrees C), 50 to 60 minutes. Remove from skillet to a serving platter and let rest 5 to 10 minutes.",
2025-08-22T02:12:10.6228292Z     "Blot about 90 percent of the chicken fat from the skillet with a paper towel held with tongs, leaving the browned bits of food in the skillet. Place skillet over medium-high heat and add thyme leaves. Cook and stir until thyme is wilted, 1 to 2 minutes. Pour lemon juice, chicken broth, and water into skillet, stirring until the browned bits dissolve and the sauce has reduced by about half, 1 to 2 minutes.",
2025-08-22T02:12:10.6232800Z     "Reduce heat to low, add cold butter, and stir until butter has begun to melt. Add any accumulated juices from the chicken to sauce and continue to stir until butter is incorporated and sauce is slightly thickened, about 1 minute. Remove from heat and season with salt, black pepper, and cayenne pepper to taste. Spoon sauce over chicken to serve."
2025-08-22T02:12:10.6235090Z   ],
2025-08-22T02:12:10.6235712Z   "image_url": "https://images.media-allrecipes.com/userphotos/720x405/4560646.jpg"
2025-08-22T02:12:10.6236365Z }
2025-08-22T02:12:10.6236533Z 
2025-08-22T02:12:10.6237037Z 🧪 Testing Alternative Field Names
2025-08-22T02:12:10.6237686Z ✅ Alternative field names mapped correctly:
2025-08-22T02:12:10.6238224Z    Name: Chef John's Salt Roasted Chicken
2025-08-22T02:12:10.6238660Z    Ingredients: 2 items
2025-08-22T02:12:10.6239016Z    Instructions: 2 steps
2025-08-22T02:12:10.6239241Z 
2025-08-22T02:12:10.6239445Z 🔍 Recipe Validation
2025-08-22T02:12:10.6239840Z    ✅ Recipe Name: Valid
2025-08-22T02:12:10.6240235Z    ✅ Ingredients: Valid
2025-08-22T02:12:10.6240627Z    ✅ Instructions: Valid
2025-08-22T02:12:10.6241026Z    ✅ Source URL: Valid
2025-08-22T02:12:10.6241428Z    ✅ Description: Valid
2025-08-22T02:12:10.6241818Z    ✅ Prep Time: Valid
2025-08-22T02:12:10.6242213Z    ✅ Cook Time: Valid
2025-08-22T02:12:10.6242574Z    ✅ Servings: Valid
2025-08-22T02:12:10.6242784Z 
2025-08-22T02:12:10.6243074Z 📊 Validation Results: 8/8 passed
2025-08-22T02:12:10.6243348Z 
2025-08-22T02:12:10.6243853Z 🎉 All tests passed! The recipe extraction is working perfectly.
2025-08-22T02:12:10.6244285Z 
2025-08-22T02:12:10.6244575Z 🎯 Specific recipe tests completed!
2025-08-22T02:12:10.6310065Z ✅ test-specific-recipe.js completed successfully
2025-08-22T02:12:10.6310463Z 
2025-08-22T02:12:10.6310840Z 🔍 Running test-unit-functions-fixed.js...
2025-08-22T02:12:10.6311561Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.6693162Z 🧪 Running Fixed Unit Tests for Recipe Clipper Functions
2025-08-22T02:12:10.6693662Z 
2025-08-22T02:12:10.6707098Z ✅ extractRecipeFromAIResponse - handles valid recipe response
2025-08-22T02:12:10.6708262Z ✅ extractRecipeFromAIResponse - handles null response
2025-08-22T02:12:10.6709838Z ✅ extractRecipeFromAIResponse - handles recipe with time fields
2025-08-22T02:12:10.6712540Z ✅ extractRecipeFromAIResponse - handles nutrition data
2025-08-22T02:12:10.6714682Z ✅ extractRecipeFromAIResponse - handles rating data
2025-08-22T02:12:10.6716532Z ✅ extractRecipeFromAIResponse - handles video data
2025-08-22T02:12:10.6718442Z ✅ extractRecipeFromAIResponse - handles array image
2025-08-22T02:12:10.6721079Z ✅ extractRecipeFromAIResponse - handles string instructions
2025-08-22T02:12:10.6722450Z ✅ extractRecipeFromAIResponse - handles object author
2025-08-22T02:12:10.6724083Z ✅ extractRecipeFromAIResponse - handles missing optional fields
2025-08-22T02:12:10.6725800Z ✅ extractRecipeFromAIResponse - handles complex instructions
2025-08-22T02:12:10.6731968Z Cleaned JSON content (first 300 chars): { invalid json...
2025-08-22T02:12:10.6748378Z Error extracting recipe from AI response: Error: Failed to parse recipe data from AI response
2025-08-22T02:12:10.6749939Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1830:13)
2025-08-22T02:12:10.6751797Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:288:18
2025-08-22T02:12:10.6753267Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:11:5)
2025-08-22T02:12:10.6754756Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:277:1
2025-08-22T02:12:10.6755847Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.6756931Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.6757795Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.6758591Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.6759643Z ✅ extractRecipeFromAIResponse - handles error gracefully
2025-08-22T02:12:10.6760594Z ✅ extractRecipeFromAIResponse - handles empty response
2025-08-22T02:12:10.6762126Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.6763884Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.6765382Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:306:18
2025-08-22T02:12:10.6766964Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:11:5)
2025-08-22T02:12:10.6768309Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:299:1
2025-08-22T02:12:10.6769336Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.6770145Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.6770923Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.6771678Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.6773158Z Error extracting recipe from AI response: Error: Incomplete recipe data extracted - missing name, image, recipeIngredient, or recipeInstructions
2025-08-22T02:12:10.6774877Z     at extractRecipeFromAIResponse (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:1863:15)
2025-08-22T02:12:10.6776353Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:348:18
2025-08-22T02:12:10.6777854Z     at test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:11:5)
2025-08-22T02:12:10.6779221Z     at file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-unit-functions-fixed.js:333:1
2025-08-22T02:12:10.6780220Z     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
2025-08-22T02:12:10.6781245Z     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
2025-08-22T02:12:10.6782026Z     at async loadESM (node:internal/process/esm_loader:34:7)
2025-08-22T02:12:10.6782763Z     at async handleMainPromise (node:internal/modules/run_main:106:12)
2025-08-22T02:12:10.6783702Z ✅ extractRecipeFromAIResponse - handles missing content
2025-08-22T02:12:10.6784616Z ✅ extractRecipeFromAIResponse - handles alternative field names
2025-08-22T02:12:10.6785513Z ✅ extractRecipeFromAIResponse - validates required fields
2025-08-22T02:12:10.6786364Z ✅ extractRecipeFromAIResponse - handles yield variations
2025-08-22T02:12:10.6787401Z ✅ extractRecipeFromAIResponse - handles keywords variations
2025-08-22T02:12:10.6787827Z 
2025-08-22T02:12:10.6788068Z ==================================================
2025-08-22T02:12:10.6788594Z 📊 Fixed Unit Test Summary:
2025-08-22T02:12:10.6789005Z    ✅ Passed: 18
2025-08-22T02:12:10.6789335Z    ❌ Failed: 0
2025-08-22T02:12:10.6789677Z    📁 Total: 18
2025-08-22T02:12:10.6789859Z 
2025-08-22T02:12:10.6790129Z 🎉 All fixed unit tests passed!
2025-08-22T02:12:10.6881872Z ✅ test-unit-functions-fixed.js completed successfully
2025-08-22T02:12:10.6882314Z 
2025-08-22T02:12:10.6882692Z 🔍 Running test-utility-functions.js...
2025-08-22T02:12:10.6883430Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.7249716Z 🧪 Running Utility Function Tests
2025-08-22T02:12:10.7255159Z ──────────────────────────────────────────────────
2025-08-22T02:12:10.7311145Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.7312391Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.7313969Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.7315488Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:110:20
2025-08-22T02:12:10.7317458Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:24:5)
2025-08-22T02:12:10.7319097Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:39:1
2025-08-22T02:12:10.7591927Z ✅ convertTimeToISO8601 - converts various time formats
2025-08-22T02:12:10.7595174Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.7596437Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.7598069Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.7599712Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:188:20
2025-08-22T02:12:10.7601235Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:24:5)
2025-08-22T02:12:10.7602706Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:117:1
2025-08-22T02:12:10.7603921Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.7605034Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.7606423Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.7608169Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:274:20
2025-08-22T02:12:10.7609649Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:24:5)
2025-08-22T02:12:10.7611022Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:195:1
2025-08-22T02:12:10.7612225Z ✅ HTML extraction functions - extract metadata from HTML
2025-08-22T02:12:10.7613346Z ✅ JSON-LD processing - handles structured data
2025-08-22T02:12:10.7614128Z Recipe extraction error: ReferenceError: crypto is not defined
2025-08-22T02:12:10.7615180Z     at generateRecipeId (file:///home/runner/work/seasoned-app/seasoned-app/shared/kv-storage.js:11:3)
2025-08-22T02:12:10.7616444Z     at Object.fetch (file:///home/runner/work/seasoned-app/seasoned-app/clipper/src/recipe-clipper.js:82:34)
2025-08-22T02:12:10.7617975Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:333:20
2025-08-22T02:12:10.7619352Z     at async test (file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:24:5)
2025-08-22T02:12:10.7620695Z     at async file:///home/runner/work/seasoned-app/seasoned-app/clipper/tests/test-utility-functions.js:281:1
2025-08-22T02:12:10.7621792Z ✅ Additional utility function coverage
2025-08-22T02:12:10.7622119Z 
2025-08-22T02:12:10.7622438Z 📊 Utility Function Tests Summary
2025-08-22T02:12:10.7623112Z These tests exercise previously untested utility functions
2025-08-22T02:12:10.7623763Z to improve overall function coverage.
2025-08-22T02:12:10.7624737Z ✅ Current local function coverage should be >90%
2025-08-22T02:12:10.7861279Z ✅ test-utility-functions.js completed successfully
2025-08-22T02:12:10.7861856Z 
2025-08-22T02:12:10.7862125Z ==================================================
2025-08-22T02:12:10.7862731Z 📊 Test Summary:
2025-08-22T02:12:10.7863165Z    ✅ Passed: 8
2025-08-22T02:12:10.7863583Z    ❌ Failed: 1
2025-08-22T02:12:10.7863970Z    📁 Total: 9
2025-08-22T02:12:10.7864168Z 
2025-08-22T02:12:10.7864629Z ⚠️  Some tests failed. Please check the output above.
2025-08-22T02:12:10.8769727Z -------------------|---------|----------|---------|---------|---------------------------------------
2025-08-22T02:12:10.8771494Z File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                     
2025-08-22T02:12:10.8772627Z -------------------|---------|----------|---------|---------|---------------------------------------
2025-08-22T02:12:10.8776651Z All files          |   30.81 |    65.78 |   43.75 |   30.81 |                                       
2025-08-22T02:12:10.8800480Z  recipe-clipper.js |   30.81 |    65.78 |   43.75 |   30.81 | ...2300,2309-2310,2347-2348,2351-2352 
2025-08-22T02:12:10.8801694Z -------------------|---------|----------|---------|---------|---------------------------------------
2025-08-22T02:12:10.9183462Z ERROR: Coverage for lines (30.81%) does not meet global threshold (68%)
2025-08-22T02:12:10.9184496Z ERROR: Coverage for functions (43.75%) does not meet global threshold (93%)
2025-08-22T02:12:10.9185417Z ERROR: Coverage for statements (30.81%) does not meet global threshold (68%)
2025-08-22T02:12:10.9458420Z ##[error]Process completed with exit code 1.
